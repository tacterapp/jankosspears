<!DOCTYPE html>
<html>

<head>
    <title>Jankos Spears</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <link rel="prefetch" href="static/music2.mp3" />
    <link rel="prefetch" href="static/music_end.mp3" />
    <link rel="prefetch" href="static/ko.mp3" />
    <link rel="prefetch" href="static/ko_allies3.mp3" />
    <link rel="prefetch" href="static/lanza5.mp3" />
    <link rel="prefetch" href="static/lanza2.png" />

    <meta property="og:image" content="static/jankosshareimage.png">
    <meta property="og:image:secure_url" content="static/jankosshareimage.png">
    <meta property="og:image:alt" content="Jankos Spears">
    <meta property="og:image:type" content="image/png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Jankos Spears">
    <meta name="twitter:image" content="static/jankosshareimage.png">

</head>

<body>


    <style>
        body {
            background: black;
            overflow: hidden;
        }

        table {
            position: fixed;
            width: 480px;
            border: 1px black solid;
            top: 0;
            height: 100%;

            background-image: url('static/background.png');
            background-size: cover;
        }

        td {
            width: 33%;
            background: none;
            border: 1px black solid;
            overflow: hidden;
            text-align: center;
            background-repeat: no-repeat;
            background-position-x: 'center';
        }

        #lanza {
            display: none;
            z-index: 1;
            background: url('static/lanza2.png') left top;
            background-size: contain;
            position: fixed;
            left: 0;
            bottom: 0;
            width: 300px;
            height: 313px;
        }

        #header {
            font-size: 50px;
            color: white;
            text-align: center;
            left: 0;
            right: 0;
            top: 0;
            z-index: 2;
            position: fixed;
        }
    </style>

    <div id="lanza">
    </div>

    <div id="header">
        <span id="lives"></span>
        <span id="score">0</span>
    </div>


    <table cellspacing="0" cellpadding="0">
        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>


    <audio id="sound_lanza">
        <source src="static/lanza5.mp3" type="audio/mp3">
    </audio>

    <audio id="sound_ko_enemies">
        <source src="static/ko.mp3" type="audio/mp3">
    </audio>

    <audio id="sound_ko_allies">
        <source src="static/ko_allies3.mp3" type="audio/mp3">
    </audio>

    <audio id="music" loop>
        <source src="static/music2.mp3" type="audio/mp3">
    </audio>

    <audio id="music_end" loop>
        <source src="static/music_end.mp3" type="audio/mp3">
    </audio>


    <script>
        var timer_lanza;
        var lanza_lanzada = false;
        var timer_enemies;
        var score = 0;
        var enemy_height = 212;
        var max_lives = 3;
        var total_lives = max_lives;

        var screen_height = $(document).height();
        var screen_width = $(document).width();
        var lanza_width = parseInt($('#lanza').css('width'));
        var lanza_height = parseInt($('#lanza').css('height'));
        var cell_height = parseInt($('td:first').css('height'));



        var enemies = ['bwipo', 'doinb', 'gilius', 'ls', 'nashor', 'selfmade', 'theshy', 'tian', 'xpeke', 'zanzarah'];
        var allies = ['capsandwunder', 'mikyx', 'ocelote', 'rekkles'];

        var total_cells;


        var music_playing = false;
        var music = $('#music')[0];
        var music_end = $('#music_end')[0];
        var sound_lanza = $('#sound_lanza')[0];
        var sound_ko_allies = $('#sound_ko_allies')[0];
        var sound_ko_enemies = $('#sound_ko_enemies')[0];



        timer_enemies = setInterval(function () {

            showEnemies();




        }, 5000);


        $('td').click(function (e) {





            if (!lanza_lanzada) {
                lanza_lanzada = true;

                sound_lanza.currentTime = 0;
                sound_lanza.play();


                var td_current = $(this);
                var current_type = $(this).data('who');

                var enemy_found = current_type == 'enemies';


                if (enemy_found) {
                    $(this).data('died', 1).stop();
                }





                var pos_x;// = e.pageX;
                var pos_y;// = e.pageY;

                pos_x = $(this).position().left + ((parseInt($(this).css('width'))) / 2);



                pos_y = $(this).position().top + ((parseInt($(this).css('height'))) / 2);

                pos_x += $('table').position().left;
                pos_x -= lanza_width;


                jQuery('#lanza').show().css('left', -lanza_width).css('top', (screen_height + lanza_height + e.pageY)).animate({
                    'left': pos_x + 'px',
                    'top': pos_y + 'px',
                }, 800, function () {



                    $(td_current).data('who', '').data('died', 0).css('background-position-y', cell_height);


                    if (enemy_found) {
                        score++;
                        $('#score').html(score);

                        /*
                        $(td_current).data('who', '').data('died', 0).css('background-position-y', (cell_height - 212)).animate({
                            'background-position-y': cell_height
                        }, 200);
                        */


                    }




                    setTimeout(function () {
                        $('#lanza').hide();
                        lanza_lanzada = false;

                        if (current_type == 'enemies') {
                            sound_ko_enemies.currentTime = 0;
                            sound_ko_enemies.play();
                        } else if (current_type == 'allies') {
                            sound_ko_allies.currentTime = 0;
                            sound_ko_allies.play();

                            total_lives--;
                            updateLives();

                            if (total_lives == 0) {
                                alert('game_over');
                            }
                        }

                    }, 50);
                });


            }

        });


        function randomNumber(min, max) {
            if (min > max) {
                let temp = max;
                max = min;
                min = temp;
            }

            if (min <= 0) {
                return Math.floor(Math.random() * (max + Math.abs(min) + 1)) + min;
            } else {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }
        }

        function shuffle(a) {
            var j, x, i;
            for (i = a.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                x = a[i];
                a[i] = a[j];
                a[j] = x;
            }
            return a;
        }


        var cells;
        var allies_aux;
        var enemies_aux;

        function showEnemies() {


            cells = [];
            allies_aux = [...allies];
            enemies_aux = [...enemies];
            allies_aux = shuffle(allies_aux);
            enemies_aux = shuffle(enemies_aux);



            for (var i = 0; i < total_cells; i++) {
                var rand_col = randomNumber(0, 3);

                if (rand_col == 1) {
                    if (allies_aux[0]) {
                        cells.push('allies/' + allies_aux[0]);
                        allies_aux.shift();
                    }
                } else if (rand_col == 2) {
                    if (enemies_aux[0]) {
                        cells.push('enemies/' + enemies_aux[0]);
                        enemies_aux.shift();
                    }
                } else {
                    cells.push('/');
                }
            }


            for (var j = 0; j < total_cells; j++) {



                var random_delay = randomNumber(1, 500);

                setTimeout(updateCell, random_delay, j);
            }



        }


        function updateCell(j) {

            console.log(j);


            var t_name = cells[j].split('/');
            var photo = cells[j] != '/' ? "url('static/" + cells[j] + ".png')" : 'none';

            $('td:eq(' + j + ')').data('who', t_name[0]).css('background-position-y', cell_height).css('background-image', photo).animate({
                'background-position-y': (cell_height - enemy_height)
            }, 1000);
        }

        function updateLives() {
            var html = '';

            for (var i = 0; i < total_lives; i++) {
                html += '❤';
            }
            for (var i = 0; i < (max_lives - total_lives); i++) {
                html += '♡';
            }


            $('#lives').html(html);
        }

        $(function () {


            $('body').click(function () {
                if (!music_playing) {
                    music_playing = true;
                    music.play();
                }
            });


            total_cells = $('td').length;

            $('table').css('left', (screen_width - (parseInt($('table').css('width')))) / 2);

            $('td').data('died', 0);


            showEnemies();
            updateLives();

        });

    </script>


</body>

</html>